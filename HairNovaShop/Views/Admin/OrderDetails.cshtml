@model HairNovaShop.Models.Order
@{
    ViewData["Title"] = "Chi tiết đơn hàng";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="admin-page-header">
    <h1>Chi tiết đơn hàng</h1>
    <p>Mã đơn hàng: <strong>@Model.OrderCode</strong></p>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="admin-card">
            <div class="admin-card-header">
                <h2 class="admin-card-title">Thông tin đơn hàng</h2>
            </div>
            <div class="card-body">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Sản phẩm</th>
                            <th>Dung tích</th>
                            <th>Số lượng</th>
                            <th>Đơn giá</th>
                            <th>Thành tiền</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.OrderItems)
                        {
                            <tr>
                                <td>@item.ProductName</td>
                                <td>@(item.Capacity ?? "-")</td>
                                <td>@item.Quantity</td>
                                <td>@item.Price.ToString("N0") đ</td>
                                <td><strong>@item.Subtotal.ToString("N0") đ</strong></td>
                            </tr>
                        }
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="4" class="text-end"><strong>Tạm tính:</strong></td>
                            <td><strong>@Model.Subtotal.ToString("N0") đ</strong></td>
                        </tr>
                        @if (Model.Discount > 0)
                        {
                            <tr>
                                <td colspan="4" class="text-end"><strong>Giảm giá:</strong></td>
                                <td><strong class="text-danger">-@Model.Discount.ToString("N0") đ</strong></td>
                            </tr>
                        }
                        <tr>
                            <td colspan="4" class="text-end"><strong>Tổng cộng:</strong></td>
                            <td><strong class="text-primary">@Model.Total.ToString("N0") đ</strong></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="admin-card">
            <div class="admin-card-header">
                <h2 class="admin-card-title">Thông tin khách hàng</h2>
            </div>
            <div class="card-body">
                <p><strong>Họ tên:</strong> @Model.CustomerName</p>
                <p><strong>Email:</strong> @Model.CustomerEmail</p>
                <p><strong>Số điện thoại:</strong> @Model.CustomerPhone</p>
                <hr>
                <p><strong>Địa chỉ giao hàng:</strong></p>
                <p>
                    @Model.ShippingAddress<br>
                    @Model.ShippingWard, @Model.ShippingProvince
                </p>
                @if (!string.IsNullOrEmpty(Model.ShippingOtherAddress))
                {
                    <hr>
                    <p><strong>Địa chỉ khác:</strong></p>
                    <p>
                        @Model.ShippingOtherAddress<br>
                        @Model.ShippingOtherWard, @Model.ShippingOtherProvince
                        @if (!string.IsNullOrEmpty(Model.ShippingOtherPhone))
                        {
                            @:<br>ĐT: @Model.ShippingOtherPhone
                        }
                    </p>
                }
                <hr>
                <p><strong>Phương thức thanh toán:</strong></p>
                <p>
                    @{
                        var paymentMethodName = Model.PaymentMethod switch
                        {
                            "cod" => "Thanh toán khi nhận hàng",
                            "bank" => "Chuyển khoản Ngân hàng",
                            "momo" => "Ví MoMo",
                            "vnpay" => "VNPAY",
                            _ => Model.PaymentMethod
                        };
                    }
                    @paymentMethodName
                </p>
                @if (!string.IsNullOrEmpty(Model.VoucherCode))
                {
                    <p><strong>Mã giảm giá:</strong> @Model.VoucherCode</p>
                }
                @if (!string.IsNullOrEmpty(Model.Note))
                {
                    <hr>
                    <p><strong>Ghi chú:</strong></p>
                    <p>@Model.Note</p>
                }
            </div>
        </div>

        <div class="admin-card mt-3">
            <div class="admin-card-header">
                <h2 class="admin-card-title">Trạng thái đơn hàng</h2>
            </div>
            <div class="card-body">
                @{
                    var statusClass = Model.Status switch
                    {
                        "pending" => "bg-warning",
                        "confirmed" => "bg-info",
                        "shipping" => "bg-primary",
                        "completed" => "bg-success",
                        "cancelled" => "bg-danger",
                        _ => "bg-secondary"
                    };
                    var statusName = Model.Status switch
                    {
                        "pending" => "Chờ xác nhận",
                        "confirmed" => "Đã xác nhận",
                        "shipping" => "Đang giao hàng",
                        "completed" => "Hoàn thành",
                        "cancelled" => "Đã hủy",
                        _ => Model.Status
                    };
                }
                <p><span class="badge @statusClass fs-6">@statusName</span></p>
                <p><strong>Ngày đặt:</strong> @Model.CreatedAt.ToString("dd/MM/yyyy HH:mm")</p>
                @if (Model.UpdatedAt.HasValue)
                {
                    <p><strong>Cập nhật lần cuối:</strong> @Model.UpdatedAt.Value.ToString("dd/MM/yyyy HH:mm")</p>
                }
            </div>
        </div>
    </div>
</div>

<div class="mt-3">
    <a asp-action="Orders" class="btn btn-secondary">
        <i class="fas fa-arrow-left me-2"></i>Quay lại danh sách
    </a>
</div>
